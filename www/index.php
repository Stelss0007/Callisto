<?php
//include_once 'kernel/core.php';
//coreInit();
//
//// ???????? ????? ???? ??????? ?????????
//sysCaptureMessage();
//
//// ??????? ?????????? ?? ????? ? ?????? ??????? ? ????
//list($module, $func, $type) = coreCleanFromInput('module', 'func', 'type');
//if (!$module) $module= 'test';//coreModGetVar('core_config','startpage');
//if (!$type) $type = 'user';
//if (!$func) $func="main";
//
////???? ?????? ???? ?????????? ??????
//if ($module)
//  {
//  //?????? ??????
//  $loadedmod = coreModLoad($module, $type);
//  if (empty($loadedmod))
//    {
//    // ?????? ??? ???????? ??????
//    coreException ('index.php', MODULE_NOT_EXIST, '?????? ???????? ?????? '. $module);
//    }
//
//  //????????? ???????
//  //???????? 3 ????????? empty = ?????? ????????, ?????? = ?????? ????????? ?????????, ????? ?????? - ??????
//  $modresult = coreModFunc($module, $type, $func);
//  if (!isset($modresult))
//    {
//    ShowMessage($_SERVER['HTTP_REFERER'], '????????, ? ??? ???????????? ???? ???????!');
//    //sysCaptureMessage();
//    }
//    elseif (!is_array($modresult))
//      {
//      coreException ('index.php', MODULE_FUNCTION_NOT_EXIST, '?????? ?????????? ??????? ?????? '. $func);
//      };
//  }
//else
//  {//?????? ????????
//  $modresult = array();
//  $modresult['object'] = 'MainPage';
//  };
//
//
////??????? ????????? ??????
//if ($type=='ajax' || $type=='rss')
//  {
//  $pagecontents = $modresult[content];
//  if ($type=='rss')
//    header('Content-type: application/xml');
//  }
//else
//  {
//  $smarty = new coreTpl;
//  $smarty->caching = false;
//
//  //???? ??????? ??????????????? ????? ? ??????????? ?? ? ???????????
//  blockShowAll($smarty, $modresult['object']);
//
//  //$modresult -  ????????? ?????? ??????
//  $smarty->assign('module_content', $modresult['content'], false);
//  $smarty->assign('module_browsein', $modresult['browsein']);
//  $smarty->assign('module_page_title', $modresult['page_title']);
//  $smarty->assign('module_meta_keywords', $modresult['meta_keywords']);
//  $smarty->assign('module_meta_description', $modresult['meta_description']);
//  $smarty->assign('module_object', $modresult['object']);
//
//  //??? ???????? ? ???????
//  $pageTplFile = coreGetThemePage($modresult['object']);
//  //$pagecontents = $smarty->fetch($pageTplFile);
//  $pagecontents = $smarty->display($pageTplFile);
//  }

include_once 'lib/ErrorHandler/ErrorHandler.class.php';
$errors = ErrorHandler::getInstance();


include_once 'kernel/config.php';
include_once 'kernel/core.php';
include_once 'kernel/controler.php';
include_once 'kernel/model.php';

$mod = $_GET['module'];
$function = $_GET['action'];

if(!file_exists("modules/$mod/index.php"))
  trigger_error ("Module '".$mod."' or module controler not exist", E_USER_ERROR);

include_once "modules/$mod/index.php";
//$module = new $mod();
$module = new Index($mod);
if(empty($_REQUEST['type']))
  $module->type = 'user';
else  
  $module->type = ($_REQUEST['type'] == 'user' || $_REQUEST['type'] == 'admin'  || $_REQUEST['type'] == 'ajax') ? $_REQUEST['type'] : 'user';

$module->action($function);
//$module->$function();



/////////////////////////////////////////////////////////////////////////////////



?>
